<!-- Resumen de Pago -->
<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-receipt me-2"></i>
            Resumen
          </h4>
        </div>
        <div class="card-body">
          
          <!-- Sección de Radio Buttons -->
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="mb-3">Seleccione el tipo de información:</h5>
              <div class="d-flex flex-wrap gap-3">
                
                <!-- Proporcional UTM -->
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    name="tipoInformacion" 
                    id="utm" 
                    value="utm"
                    (change)="onTipoSeleccionado('utm')"
                    [checked]="tipoSeleccionado === 'utm'">
                  <label class="form-check-label fw-bold" for="utm">
                    <i class="fas fa-chart-line text-primary me-1"></i>
                    Pacientes
                  </label>
                </div>

                <!-- IPC -->
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    name="tipoInformacion" 
                    id="ipc" 
                    value="ipc"
                    (change)="onTipoSeleccionado('ipc')"
                    [checked]="tipoSeleccionado === 'ipc'">
                  <label class="form-check-label fw-bold" for="ipc">
                    <i class="fas fa-clipboard-list text-success me-1"></i>
                    Registros 
                  </label>
                </div>

                <!-- Arancel -->
                <!-- <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    name="tipoInformacion" 
                    id="arancel" 
                    value="arancel"
                    (change)="onTipoSeleccionado('arancel')"
                    [checked]="tipoSeleccionado === 'arancel'">
                  <label class="form-check-label fw-bold" for="arancel">
                    <i class="fas fa-dollar-sign text-warning me-1"></i>
                    Arancel
                  </label>
                </div> -->

              </div>
            </div>
          </div>

          <!-- Área de Contenido -->
          <div class="row">
            <div class="col-12">
              
              <!-- Mensaje de selección -->
              <div *ngIf="!tipoSeleccionado" class="text-center text-muted py-5">
                <i class="fas fa-hand-pointer fa-3x mb-3"></i>
                <h5>Seleccione una opción para mostrar la información correspondiente</h5>
              </div>

              <!-- Tabla de Pacientes (Proporcional UTM) -->
              <div *ngIf="tipoSeleccionado === 'utm'">
                <h5 class="mb-3">
                  <i class="fas fa-users text-primary me-2"></i>
                  Lista de Pacientes
                </h5>
                
                <!-- Spinner de carga -->
                <div *ngIf="cargandoPacientes" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <p class="mt-2">Cargando información de pacientes...</p>
                </div>

                <!-- Error -->
                <div *ngIf="errorPacientes" class="alert alert-danger" role="alert">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  {{ errorPacientes }}
                </div>

                <!-- Tabla de Pacientes -->
                <div *ngIf="!cargandoPacientes && !errorPacientes" class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead class="table-primary">
                      <tr>
                        <th>ID</th>
                        <th>Nombre Completo</th>
                        <th>RUT</th>
                        <th>Teléfono</th>
                        <th>Correo</th>
                        <th>Acción</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let paciente of pacientes">
                        <td>{{ paciente.idPaciente || 'N/A' }}</td>
                        <td>{{ obtenerNombreCompleto(paciente) }}</td>
                        <td>{{ paciente.rut || 'Sin RUT' }}</td>
                        <td>{{ paciente.telefono || 'Sin teléfono' }}</td>
                        <td>{{ paciente.correo || 'Sin correo' }}</td>
                        <td>
                          <button 
                            class="btn btn-sm btn-success"
                            (click)="obtenerInformacionDetallada(paciente.idPaciente!)"
                            title="Ver información detallada del paciente"
                            [disabled]="cargandoInformacionDetallada">
                            <i class="fas fa-info-circle me-1" *ngIf="!cargandoInformacionDetallada"></i>
                            <span class="spinner-border spinner-border-sm me-1" *ngIf="cargandoInformacionDetallada"></span>
                            {{ cargandoInformacionDetallada ? 'Cargando...' : 'Ver Info' }}
                          </button>
                        </td>
                      </tr>
                      <tr *ngIf="pacientes.length === 0">
                        <td colspan="6" class="text-center text-muted">
                          No hay pacientes registrados
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Sección de datos seleccionados para UTM -->
                <div *ngIf="pacienteSeleccionado" class="mt-4">
                  <h6 class="mb-3">
                    <i class="fas fa-user-check text-success me-2"></i>
                    Información del Paciente Seleccionado
                  </h6>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="nombreSeleccionado" class="form-label fw-bold">Nombre Completo:</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="nombreSeleccionado"
                        [(ngModel)]="nombreSeleccionado"
                        readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="telefonoSeleccionado" class="form-label fw-bold">Teléfono:</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="telefonoSeleccionado"
                        [(ngModel)]="telefonoSeleccionado"
                        readonly>
                    </div>
                  </div>
                </div>

                <!-- Sección de información detallada del paciente y representante -->
                <div *ngIf="informacionDetallada" class="mt-4">
                  <div class="card border-info">
                    <div class="card-header bg-info text-white">
                      <h6 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Información Detallada del Paciente
                      </h6>
                    </div>
                    <div class="card-body">
                      
                      <!-- Información del Paciente -->
                      <div class="row mb-4">
                        <div class="col-12">
                          <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="text-primary mb-0">
                              <i class="fas fa-user me-2"></i>
                              Datos del Paciente
                            </h6>
                            <!-- Botón de editar (solo visible cuando no está en modo edición) -->
                            <!-- <button 
                              *ngIf="!modoEdicion"
                              class="btn btn-outline-primary btn-sm"
                              (click)="iniciarEdicion()"
                              [disabled]="eliminandoPaciente || confirmandoEliminacion"
                              title="Editar datos del paciente">
                              <i class="fas fa-edit me-1"></i>
                              Editar Datos
                            </button> -->
                            <!-- Botones de guardar/cancelar (solo visible en modo edición) -->
                            <div *ngIf="modoEdicion" class="d-flex gap-2">
                              <button 
                                class="btn btn-outline-secondary btn-sm"
                                (click)="cancelarEdicion()"
                                [disabled]="guardandoCambios"
                                title="Cancelar edición">
                                <i class="fas fa-times me-1"></i>
                                Cancelar
                              </button>
                              <button 
                                class="btn btn-success btn-sm"
                                (click)="guardarCambios()"
                                [disabled]="guardandoCambios"
                                title="Guardar cambios">
                                <span *ngIf="guardandoCambios" class="spinner-border spinner-border-sm me-1"></span>
                                <i *ngIf="!guardandoCambios" class="fas fa-save me-1"></i>
                                {{ guardandoCambios ? 'Guardando...' : 'Guardar' }}
                              </button>
                            </div>
                          </div>
                        </div>

                        <!-- Modo Visualización -->
                        <ng-container *ngIf="!modoEdicion">
                          <div class="col-md-6 mb-2">
                            <strong>Nombre:</strong> {{ informacionDetallada.paciente.nombre }}
                          </div>
                          <div class="col-md-6 mb-2">
                            <strong>Apellidos:</strong> {{ informacionDetallada.paciente.apellidoPaterno }} {{ informacionDetallada.paciente.apellidoMaterno }}
                          </div>
                          <div class="col-md-6 mb-2">
                            <strong>RUT:</strong> {{ informacionDetallada.paciente.rut }}
                          </div>
                          <div class="col-md-6 mb-2">
                            <strong>Teléfono:</strong> {{ informacionDetallada.paciente.telefono || 'No registrado' }}
                          </div>
                          <div class="col-md-6 mb-2">
                            <strong>Correo:</strong> {{ informacionDetallada.paciente.correo || 'No registrado' }}
                          </div>
                          <div class="col-md-6 mb-2">
                            <strong>Nacionalidad:</strong> {{ informacionDetallada.paciente.nacionalidad || 'No registrada' }}
                          </div>
                          <div class="col-12 mb-2" *ngIf="informacionDetallada.paciente.direccion">
                            <strong>Dirección:</strong> {{ informacionDetallada.paciente.direccion }}
                          </div>
                        </ng-container>

                        <!-- Modo Edición -->
                        <ng-container *ngIf="modoEdicion && datosEditados">
                          <div class="col-md-6 mb-3">
                            <label for="editNombre" class="form-label fw-bold">Nombre:</label>
                            <input 
                              type="text" 
                              class="form-control" 
                              id="editNombre"
                              [(ngModel)]="datosEditados.nombre"
                              placeholder="Nombre del paciente">
                          </div>
                          <div class="col-md-6 mb-3">
                            <label for="editApellidoPaterno" class="form-label fw-bold">Apellido Paterno:</label>
                            <input 
                              type="text" 
                              class="form-control" 
                              id="editApellidoPaterno"
                              [(ngModel)]="datosEditados.apellidoPaterno"
                              placeholder="Apellido paterno">
                          </div>
                          <div class="col-md-6 mb-3">
                            <label for="editApellidoMaterno" class="form-label fw-bold">Apellido Materno:</label>
                            <input 
                              type="text" 
                              class="form-control" 
                              id="editApellidoMaterno"
                              [(ngModel)]="datosEditados.apellidoMaterno"
                              placeholder="Apellido materno (opcional)">
                          </div>
                          <div class="col-md-6 mb-3">
                            <label for="editRut" class="form-label fw-bold">RUT:</label>
                            <input 
                              type="text" 
                              class="form-control" 
                              id="editRut"
                              [(ngModel)]="datosEditados.rut"
                              placeholder="12345678-9">
                          </div>
                          <div class="col-md-6 mb-3">
                            <label for="editTelefono" class="form-label fw-bold">Teléfono:</label>
                            <input 
                              type="text" 
                              class="form-control" 
                              id="editTelefono"
                              [(ngModel)]="datosEditados.telefono"
                              placeholder="+56 9 1234 5678">
                          </div>
                          <div class="col-md-6 mb-3">
                            <label for="editCorreo" class="form-label fw-bold">Correo:</label>
                            <input 
                              type="email" 
                              class="form-control" 
                              id="editCorreo"
                              [(ngModel)]="datosEditados.correo"
                              placeholder="correo@ejemplo.com">
                          </div>
                          <div class="col-md-6 mb-3">
                            <label for="editNacionalidad" class="form-label fw-bold">Nacionalidad:</label>
                            <select class="form-select" id="editNacionalidad" [(ngModel)]="datosEditados.nacionalidad">
                              <option value="Chilena">Chilena</option>
                              <option value="Argentina">Argentina</option>
                              <option value="Peruana">Peruana</option>
                              <option value="Boliviana">Boliviana</option>
                              <option value="Brasileña">Brasileña</option>
                              <option value="Colombiana">Colombiana</option>
                              <option value="Ecuatoriana">Ecuatoriana</option>
                              <option value="Venezolana">Venezolana</option>
                              <option value="Otra">Otra</option>
                            </select>
                          </div>
                          <div class="col-12 mb-3">
                            <label for="editDireccion" class="form-label fw-bold">Dirección:</label>
                            <textarea 
                              class="form-control" 
                              id="editDireccion"
                              [(ngModel)]="datosEditados.direccion"
                              rows="2"
                              placeholder="Dirección completa del paciente"></textarea>
                          </div>
                        </ng-container>
                      </div>
                        
                      <!-- Botón de eliminar paciente -->
                      <div class="col-12 mt-3">
                        <div class="d-flex justify-content-end">
                          <!-- Botón inicial para eliminar -->
                          <button 
                            *ngIf="!confirmandoEliminacion"
                            class="btn btn-danger btn-sm"
                            (click)="confirmarEliminacion()"
                            [disabled]="eliminandoPaciente"
                            title="Eliminar paciente de la base de datos">
                            <i class="fas fa-trash me-2"></i>
                            Eliminar Paciente
                          </button>
                          
                          <!-- Confirmación de eliminación -->
                          <div *ngIf="confirmandoEliminacion" class="d-flex align-items-center">
                            <span class="text-danger me-3">
                              <i class="fas fa-exclamation-triangle me-1"></i>
                              ¿Está seguro de eliminar este paciente?
                            </span>
                            <button 
                              class="btn btn-outline-secondary btn-sm me-2"
                              (click)="cancelarEliminacion()"
                              [disabled]="eliminandoPaciente">
                              <i class="fas fa-times me-1"></i>
                              Cancelar
                            </button>
                            <button 
                              class="btn btn-danger btn-sm"
                              (click)="eliminarPaciente()"
                              [disabled]="eliminandoPaciente">
                              <span *ngIf="eliminandoPaciente" class="spinner-border spinner-border-sm me-2"></span>
                              <i *ngIf="!eliminandoPaciente" class="fas fa-check me-1"></i>
                              {{ eliminandoPaciente ? 'Eliminando...' : 'Confirmar' }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Información del Representante (si existe) -->
                      <div *ngIf="informacionDetallada.representante" class="row">
                        <div class="col-12">
                          <h6 class="text-success mb-3">
                            <i class="fas fa-users me-2"></i>
                            Datos del Representante
                          </h6>
                        </div>
                        <div class="col-md-6 mb-2">
                          <strong>Nombre:</strong> {{ informacionDetallada.representante.nombre }}
                        </div>
                        <div class="col-md-6 mb-2">
                          <strong>Apellido:</strong> {{ informacionDetallada.representante.apellido }}
                        </div>
                        <div class="col-md-6 mb-2">
                          <strong>RUT:</strong> {{ informacionDetallada.representante.rut }}
                        </div>
                        <div class="col-md-6 mb-2">
                          <strong>Teléfono:</strong> {{ informacionDetallada.representante.telefono || 'No registrado' }}
                        </div>
                        <div class="col-md-6 mb-2">
                          <strong>Correo:</strong> {{ informacionDetallada.representante.correo || 'No registrado' }}
                        </div>
                        <div class="col-12 mb-2" *ngIf="informacionDetallada.representante.direccion">
                          <strong>Dirección:</strong> {{ informacionDetallada.representante.direccion }}
                        </div>
                      </div>

                      <!-- Mensaje si no tiene representante -->
                      <div *ngIf="!informacionDetallada.representante" class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Este paciente no tiene representante asignado.
                      </div>

                    </div>
                  </div>
                </div>

                <!-- Mensaje de error para información detallada -->
                <div *ngIf="errorInformacionDetallada" class="mt-4">
                  <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {{ errorInformacionDetallada }}
                  </div>
                </div>
              </div>

              <!-- Tabla de Evaluaciones (IPC) -->
              <div *ngIf="tipoSeleccionado === 'ipc'">
                <h5 class="mb-3">
                  <i class="fas fa-clipboard-check text-success me-2"></i>
                  Lista de Evaluaciones
                </h5>
                
                <!-- Spinner de carga -->
                <div *ngIf="cargandoEvaluaciones" class="text-center py-4">
                  <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <p class="mt-2">Cargando evaluaciones...</p>
                </div>

                <!-- Error -->
                <div *ngIf="errorEvaluaciones" class="alert alert-danger" role="alert">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  {{ errorEvaluaciones }}
                </div>

                <!-- Tabla de Evaluaciones -->
                <div *ngIf="!cargandoEvaluaciones && !errorEvaluaciones" class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead class="table-success">
                      <tr>
                        <th>ID Evaluación</th>
                        <th>Paciente</th>
                        <th>Tipo Formulario</th>
                        <th>Progreso</th>
                        <th>Estado</th>
                        <th>Fecha</th>
                        <th>Evaluador</th>
                        <th>Acción</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let evaluacion of evaluaciones">
                        <td>{{ evaluacion.idEvaluacion || 'N/A' }}</td>
                        <td>{{ evaluacion.nombreCompleto || 'Sin nombre' }}</td>
                        <td>
                          <span class="badge bg-info">
                            {{ evaluacion.tipoFormulario || 'No especificado' }}
                          </span>
                        </td>
                        <td>
                          <div class="progress" style="height: 20px;">
                            <div 
                              class="progress-bar" 
                              role="progressbar" 
                              [style.width.%]="evaluacion.progreso"
                              [attr.aria-valuenow]="evaluacion.progreso" 
                              aria-valuemin="0" 
                              aria-valuemax="100">
                              {{ evaluacion.progreso }}%
                            </div>
                          </div>
                        </td>
                        <td>
                          <span 
                            class="badge"
                            [ngClass]="{
                              'bg-success': evaluacion.estado === 'Completada',
                              'bg-warning': evaluacion.estado === 'En Progreso',
                              'bg-secondary': evaluacion.estado === 'Borrador'
                            }">
                            {{ evaluacion.estado || 'Sin estado' }}
                          </span>
                        </td>
                        <td>{{ formatearFecha(evaluacion.fechaEvaluacion || '') }}</td>
                        <td>{{ evaluacion.evaluadorNombre || 'Sin evaluador' }}</td>
                        <td>
                          <!-- <button 
                            class="btn btn-sm btn-success"
                            (click)="seleccionarEvaluacion(evaluacion)"
                            title="Seleccionar evaluación">
                            <i class="fas fa-arrow-right me-1"></i>
                            Ir
                          </button> -->
                        </td>
                      </tr>
                      <tr *ngIf="evaluaciones.length === 0">
                        <td colspan="8" class="text-center text-muted">
                          No hay evaluaciones registradas
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Sección de datos seleccionados para IPC -->
                <div *ngIf="evaluacionSeleccionada" class="mt-4">
                  <h6 class="mb-3">
                    <i class="fas fa-clipboard-check text-success me-2"></i>
                    Información de la Evaluación Seleccionada
                  </h6>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="nombrePacienteSeleccionado" class="form-label fw-bold">Nombre del Paciente:</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="nombrePacienteSeleccionado"
                        [(ngModel)]="nombrePacienteSeleccionado"
                        readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="fechaSeleccionada" class="form-label fw-bold">Fecha de Evaluación:</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="fechaSeleccionada"
                        [(ngModel)]="fechaSeleccionada"
                        readonly>
                    </div>
                  </div>
                </div>
              </div>



              <!-- Mensaje para Arancel -->
              <div *ngIf="tipoSeleccionado === 'arancel'" class="text-center text-muted py-5">
                <i class="fas fa-dollar-sign fa-3x mb-3 text-warning"></i>
                <h5>Información de Arancel</h5>
                <p>Esta funcionalidad estará disponible próximamente.</p>
              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
      